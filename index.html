<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColabNotes - Bloco de Notas Colaborativo</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .online-dot {
            width: 10px;
            height: 10px;
            background-color: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ============================================
        // CONFIGURAÇÃO E UTILITÁRIOS
        // ============================================
        
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAS2tOdf-Xjq5lRHeKC_Fjx0tSoMyCKkas",
            authDomain: "notas-c6160.firebaseapp.com",
            projectId: "notas-c6160",
            storageBucket: "notas-c6160.firebasestorage.app",
            messagingSenderId: "963622058510",
            appId: "1:963622058510:web:4d7c1c7e1d02c837811a5f",
            measurementId: "G-B6H79DLBNR"
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Funções utilitárias
        const utils = {
            formatDate: (timestamp) => {
                if (!timestamp) return '';
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'agora';
                if (diffMins < 60) return `${diffMins} min atrás`;
                if (diffHours < 24) return `${diffHours}h atrás`;
                if (diffDays < 7) return `${diffDays}d atrás`;
                
                return date.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: 'short'
                });
            },
            
            getUserColor: (userId) => {
                const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
                if (!userId) return colors[0];
                const hash = userId.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                return colors[hash % colors.length];
            },
            
            sendNotification: (title, body) => {
                if (!("Notification" in window)) return;
                if (Notification.permission === "granted") {
                    new Notification(title, { body });
                }
            }
        };

        // ============================================
        // COMPONENTES REUSÁVEIS
        // ============================================

        // Componente Modal
        function Modal({ isOpen, onClose, title, children, size = 'md' }) {
            if (!isOpen) return null;
            
            const sizes = {
                sm: 'max-w-md',
                md: 'max-w-lg',
                lg: 'max-w-2xl',
                xl: 'max-w-4xl'
            };
            
            return React.createElement('div', {
                className: 'fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4 fade-in'
            },
                React.createElement('div', {
                    className: `bg-white rounded-xl shadow-2xl w-full ${sizes[size]} overflow-hidden`
                },
                    React.createElement('div', { className: 'flex justify-between items-center p-4 border-b' },
                        React.createElement('h3', { className: 'text-lg font-bold text-gray-800' }, title),
                        React.createElement('button', {
                            onClick: onClose,
                            className: 'text-gray-500 hover:text-red-500 transition'
                        },
                            React.createElement('i', { className: 'fa-solid fa-times text-xl' })
                        )
                    ),
                    React.createElement('div', { className: 'p-4 max-h-[80vh] overflow-y-auto' }, children)
                )
            );
        }

        // ============================================
        // COMPONENTE PRINCIPAL
        // ============================================

        function App() {
            // Estados principais
            const [user, setUser] = React.useState(null);
            const [username, setUsername] = React.useState('');
            const [notes, setNotes] = React.useState([]);
            const [comments, setComments] = React.useState([]);
            const [onlineUsers, setOnlineUsers] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            
            // Estados da UI
            const [showAuthModal, setShowAuthModal] = React.useState(true);
            const [isNoteModalOpen, setIsNoteModalOpen] = React.useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = React.useState(false);
            const [activeNote, setActiveNote] = React.useState(null);
            
            // Formulários
            const [formTitle, setFormTitle] = React.useState('');
            const [formContent, setFormContent] = React.useState('');
            const [formDate, setFormDate] = React.useState('');
            const [newComment, setNewComment] = React.useState('');
            
            // Configurações
            const [userColor, setUserColor] = React.useState('#3b82f6');

            // ============================================
            // EFEITOS E LIFECYCLE
            // ============================================

            // Efeito 1: Autenticação
            React.useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (u) => {
                    if (u) {
                        setUser(u);
                        
                        // Define nome do usuário
                        let name = u.displayName;
                        if (u.isAnonymous) {
                            const savedName = localStorage.getItem(`username_${u.uid}`);
                            if (savedName) {
                                name = savedName;
                            } else {
                                // Pede nome se for anônimo
                                setTimeout(() => {
                                    const userName = prompt("Como gostaria de ser chamado?", "Visitante");
                                    const finalName = userName && userName.trim() ? userName.trim() : 'Visitante';
                                    setUsername(finalName);
                                    localStorage.setItem(`username_${u.uid}`, finalName);
                                    
                                    // Salva no Firestore
                                    db.collection('users').doc(u.uid).set({
                                        name: finalName,
                                        isAnonymous: true,
                                        lastSeen: Date.now()
                                    }, { merge: true });
                                }, 1000);
                                name = 'Visitante';
                            }
                        } else {
                            name = u.displayName || u.email?.split('@')[0] || 'Usuário';
                            
                            // Salva usuário registrado
                            await db.collection('users').doc(u.uid).set({
                                name: name,
                                email: u.email,
                                lastSeen: Date.now()
                            }, { merge: true });
                        }
                        
                        setUsername(name);
                        setUserColor(utils.getUserColor(u.uid));
                        setShowAuthModal(false);
                        setLoading(false);
                    } else {
                        // Se não tem usuário, cria anônimo
                        auth.signInAnonymously().catch(console.error);
                    }
                });

                return () => unsubscribe();
            }, []);

            // Efeito 2: Atualizar presença
            React.useEffect(() => {
                if (!user) return;
                
                const updatePresence = () => {
                    db.collection('users').doc(user.uid).set({
                        lastSeen: Date.now(),
                        online: true
                    }, { merge: true });
                };
                
                updatePresence();
                const interval = setInterval(updatePresence, 30000);
                
                return () => {
                    clearInterval(interval);
                    db.collection('users').doc(user.uid).set({
                        online: false,
                        lastSeen: Date.now()
                    }, { merge: true });
                };
            }, [user]);

            // Efeito 3: Monitorar usuários online
            React.useEffect(() => {
                if (!user) return;

                const unsub = db.collection('users')
                    .where('lastSeen', '>', Date.now() - 120000)
                    .onSnapshot((snapshot) => {
                        const users = [];
                        snapshot.forEach(doc => {
                            if (doc.id !== user.uid) {
                                users.push({ id: doc.id, ...doc.data() });
                            }
                        });
                        setOnlineUsers(users);
                    });

                return () => unsub();
            }, [user]);

            // Efeito 4: Carregar notas
            React.useEffect(() => {
                if (!user) return;

                const unsubNotes = db.collection('notes')
                    .orderBy('updatedAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const loadedNotes = [];
                        snapshot.forEach(doc => {
                            loadedNotes.push({ id: doc.id, ...doc.data() });
                        });
                        setNotes(loadedNotes);
                        setLoading(false);
                    }, (error) => {
                        console.error("Erro notas:", error);
                        setLoading(false);
                    });

                return () => unsubNotes();
            }, [user]);

            // Efeito 5: Carregar comentários
            React.useEffect(() => {
                if (!user) return;

                const unsubComments = db.collection('comments')
                    .orderBy('createdAt', 'asc')
                    .onSnapshot((snapshot) => {
                        const loadedComments = [];
                        snapshot.forEach(doc => {
                            loadedComments.push({ id: doc.id, ...doc.data() });
                        });
                        setComments(loadedComments);
                    });

                return () => unsubComments();
            }, [user]);

            // ============================================
            // HANDLERS (Funções de ação)
            // ============================================

            const handleAuth = (e) => {
                e.preventDefault();
                if (!username.trim()) return;
                localStorage.setItem(`username_${user.uid}`, username);
                setShowAuthModal(false);
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    window.location.reload();
                } catch (error) {
                    console.error("Erro ao sair:", error);
                }
            };

            const handleSaveNote = async () => {
                if (!formTitle.trim() || !user) {
                    alert("Título é obrigatório!");
                    return;
                }

                const noteData = {
                    title: formTitle,
                    content: formContent,
                    reminderDate: formDate,
                    author: username,
                    authorId: user.uid,
                    updatedAt: Date.now(),
                    lastEditor: username
                };

                try {
                    if (activeNote) {
                        // Editar
                        await db.collection('notes').doc(activeNote.id).update(noteData);
                    } else {
                        // Criar nova
                        noteData.createdAt = Date.now();
                        noteData.viewCount = 0;
                        noteData.commentCount = 0;
                        await db.collection('notes').add(noteData);
                    }
                    closeNoteModal();
                } catch (err) {
                    console.error(err);
                    alert("Erro ao salvar. Tente novamente.");
                }
            };

            const handleDeleteNote = async (id) => {
                if (!confirm("Excluir esta nota permanentemente?")) return;
                try {
                    await db.collection('notes').doc(id).delete();
                    if (activeNote && activeNote.id === id) closeNoteModal();
                } catch (err) {
                    console.error(err);
                }
            };

            const handleSendComment = async () => {
                if (!newComment.trim() || !activeNote || !user) return;

                const commentData = {
                    noteId: activeNote.id,
                    content: newComment,
                    author: username,
                    authorId: user.uid,
                    createdAt: Date.now()
                };

                try {
                    await db.collection('comments').add(commentData);
                    setNewComment('');
                    
                    // Atualiza contador na nota
                    await db.collection('notes').doc(activeNote.id).update({
                        updatedAt: Date.now()
                    });
                } catch (err) {
                    console.error(err);
                }
            };

            const handleLikeNote = async (noteId, e) => {
                e.stopPropagation();
                if (!user) return;
                
                try {
                    const likeRef = db.collection('likes').doc(`${noteId}_${user.uid}`);
                    const likeDoc = await likeRef.get();
                    
                    if (likeDoc.exists) {
                        await likeRef.delete();
                        await db.collection('notes').doc(noteId).update({
                            likeCount: firebase.firestore.FieldValue.increment(-1)
                        });
                    } else {
                        await likeRef.set({
                            noteId,
                            userId: user.uid,
                            userName: username,
                            createdAt: Date.now()
                        });
                        await db.collection('notes').doc(noteId).update({
                            likeCount: firebase.firestore.FieldValue.increment(1)
                        });
                    }
                } catch (err) {
                    console.error(err);
                }
            };

            // ============================================
            // FUNÇÕES DE UI
            // ============================================

            const openNewNote = () => {
                setFormTitle('');
                setFormContent('');
                setFormDate('');
                setActiveNote(null);
                setIsNoteModalOpen(true);
            };

            const openEditNote = (note) => {
                setFormTitle(note.title);
                setFormContent(note.content);
                setFormDate(note.reminderDate || '');
                setActiveNote(note);
                setIsNoteModalOpen(true);
                
                // Incrementa visualização
                if (note.authorId !== user.uid) {
                    db.collection('notes').doc(note.id).update({
                        viewCount: firebase.firestore.FieldValue.increment(1)
                    });
                }
            };

            const closeNoteModal = () => {
                setIsNoteModalOpen(false);
                setActiveNote(null);
            };

            // ============================================
            // RENDERIZAÇÃO
            // ============================================

            // Loading state
            if (loading) {
                return React.createElement('div', {
                    className: 'flex h-screen items-center justify-center'
                },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'spinner mx-auto mb-4' }),
                        React.createElement('p', { className: 'text-gray-600' }, 'Carregando...')
                    )
                );
            }

            // Calcula estatísticas
            const userNotesCount = notes.filter(n => n.authorId === user?.uid).length;
            const totalComments = comments.length;
            const activeComments = activeNote ? comments.filter(c => c.noteId === activeNote.id) : [];

            // ============================================
            // ESTRUTURA PRINCIPAL DO APP
            // ============================================

            return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                // Header
                React.createElement('header', {
                    className: 'bg-white shadow-sm sticky top-0 z-20 border-b'
                },
                    React.createElement('div', {
                        className: 'max-w-7xl mx-auto px-4 py-3'
                    },
                        React.createElement('div', {
                            className: 'flex justify-between items-center'
                        },
                            // Logo
                            React.createElement('div', {
                                className: 'flex items-center gap-3'
                            },
                                React.createElement('div', {
                                    className: 'bg-blue-600 text-white p-2 rounded-lg'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-users text-xl' })
                                ),
                                React.createElement('div', null,
                                    React.createElement('h1', {
                                        className: 'text-xl font-bold text-gray-800'
                                    }, 'ColabNotes'),
                                    React.createElement('p', {
                                        className: 'text-xs text-gray-500'
                                    }, 'Notas colaborativas em tempo real')
                                )
                            ),
                            
                            // Direita: Usuário e ações
                            React.createElement('div', {
                                className: 'flex items-center gap-4'
                            },
                                // Status online
                                React.createElement('div', {
                                    className: 'hidden md:flex items-center gap-2 text-sm text-gray-600'
                                },
                                    React.createElement('span', {
                                        className: 'online-dot'
                                    }),
                                    React.createElement('span', null, `${onlineUsers.length + 1} online`)
                                ),
                                
                                // Info do usuário
                                React.createElement('div', {
                                    className: 'flex items-center gap-2'
                                },
                                    React.createElement('div', {
                                        className: 'w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold',
                                        style: { backgroundColor: userColor }
                                    },
                                        username.charAt(0).toUpperCase()
                                    ),
                                    React.createElement('div', { className: 'text-sm' },
                                        React.createElement('div', {
                                            className: 'font-medium'
                                        }, username),
                                        React.createElement('div', {
                                            className: 'text-xs text-gray-500'
                                        }, user?.isAnonymous ? 'Visitante' : 'Usuário')
                                    )
                                ),
                                
                                // Botão de sair
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: 'text-gray-500 hover:text-red-600 p-2',
                                    title: 'Sair'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-right-from-bracket' })
                                ),
                                
                                // Botão nova nota
                                React.createElement('button', {
                                    onClick: openNewNote,
                                    className: 'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition flex items-center gap-2'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-plus' }),
                                    React.createElement('span', { className: 'hidden sm:inline' }, 'Nova Nota')
                                )
                            )
                        ),
                        
                        // Barra inferior do header
                        React.createElement('div', {
                            className: 'flex justify-between items-center mt-2 text-xs text-gray-500'
                        },
                            React.createElement('div', {
                                className: 'flex items-center gap-4'
                            },
                                React.createElement('span', null,
                                    React.createElement('i', { className: 'fa-solid fa-user mr-1' }),
                                    `${username} • ${userNotesCount} notas suas`
                                ),
                                React.createElement('span', null,
                                    React.createElement('i', { className: 'fa-solid fa-note-sticky mr-1' }),
                                    `${notes.length} notas totais`
                                )
                            ),
                            React.createElement('button', {
                                onClick: () => setIsSettingsOpen(true),
                                className: 'text-gray-500 hover:text-blue-600',
                                title: 'Configurações'
                            },
                                React.createElement('i', { className: 'fa-solid fa-gear' })
                            )
                        )
                    )
                ),
                
                // Conteúdo principal
                React.createElement('main', {
                    className: 'max-w-7xl mx-auto px-4 py-6'
                },
                    notes.length === 0 ? (
                        // Estado vazio
                        React.createElement('div', {
                            className: 'text-center py-20'
                        },
                            React.createElement('i', {
                                className: 'fa-solid fa-users-between-lines text-6xl text-gray-300 mb-4'
                            }),
                            React.createElement('h2', {
                                className: 'text-2xl font-bold text-gray-700 mb-2'
                            }, 'Bem-vindo ao espaço colaborativo!'),
                            React.createElement('p', {
                                className: 'text-gray-600 mb-6'
                            }, 'Ainda não há notas. Crie a primeira e outros usuários poderão ver e colaborar.'),
                            React.createElement('button', {
                                onClick: openNewNote,
                                className: 'bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition text-lg'
                            },
                                React.createElement('i', { className: 'fa-solid fa-plus mr-2' }),
                                'Criar Primeira Nota'
                            ),
                            React.createElement('p', {
                                className: 'text-sm text-gray-500 mt-4'
                            }, 'Todas as notas são públicas e podem ser vistas/editadas por qualquer usuário')
                        )
                    ) : (
                        // Grid de notas
                        React.createElement('div', { className: 'space-y-6' },
                            // Estatísticas
                            React.createElement('div', {
                                className: 'grid grid-cols-1 md:grid-cols-4 gap-4'
                            },
                                ['Notas', 'Comentários', 'Online', 'Suas Notas'].map((title, idx) => 
                                    React.createElement('div', {
                                        key: idx,
                                        className: 'bg-white p-4 rounded-xl shadow-sm border'
                                    },
                                        React.createElement('div', {
                                            className: 'flex justify-between items-center'
                                        },
                                            React.createElement('div', null,
                                                React.createElement('p', {
                                                    className: 'text-sm text-gray-500'
                                                }, title),
                                                React.createElement('p', {
                                                    className: 'text-2xl font-bold text-gray-800'
                                                }, 
                                                    idx === 0 ? notes.length :
                                                    idx === 1 ? totalComments :
                                                    idx === 2 ? onlineUsers.length + 1 :
                                                    userNotesCount
                                                )
                                            ),
                                            React.createElement('div', {
                                                className: `p-3 rounded-lg ${
                                                    idx === 0 ? 'bg-blue-100' :
                                                    idx === 1 ? 'bg-green-100' :
                                                    idx === 2 ? 'bg-purple-100' :
                                                    'bg-yellow-100'
                                                }`
                                            },
                                                React.createElement('i', {
                                                    className: `${
                                                        idx === 0 ? 'fa-solid fa-note-sticky text-blue-600' :
                                                        idx === 1 ? 'fa-solid fa-comments text-green-600' :
                                                        idx === 2 ? 'fa-solid fa-users text-purple-600' :
                                                        'fa-solid fa-user text-yellow-600'
                                                    } text-xl`
                                                })
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Grid de notas
                            React.createElement('div', null,
                                React.createElement('div', {
                                    className: 'flex justify-between items-center mb-4'
                                },
                                    React.createElement('h2', {
                                        className: 'text-lg font-bold text-gray-800'
                                    },
                                        React.createElement('i', { className: 'fa-solid fa-layer-group mr-2' }),
                                        `Todas as Notas (${notes.length})`
                                    ),
                                    React.createElement('div', {
                                        className: 'text-sm text-gray-500'
                                    }, 'Clique para ver e colaborar')
                                ),
                                
                                React.createElement('div', {
                                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'
                                },
                                    notes.map(note => 
                                        React.createElement('div', {
                                            key: note.id,
                                            onClick: () => openEditNote(note),
                                            className: 'bg-white rounded-xl shadow-sm hover:shadow-md transition-all cursor-pointer border border-gray-100 overflow-hidden group flex flex-col h-72 note-card'
                                        },
                                            note.authorId === user?.uid && React.createElement('div', {
                                                className: 'absolute top-3 right-3 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full'
                                            },
                                                React.createElement('i', { className: 'fa-solid fa-crown mr-1' }),
                                                'Sua'
                                            ),
                                            
                                            React.createElement('div', {
                                                className: 'p-5 flex-1 overflow-hidden'
                                            },
                                                React.createElement('div', {
                                                    className: 'flex justify-between items-start mb-2'
                                                },
                                                    React.createElement('h3', {
                                                        className: 'font-bold text-lg text-gray-800 line-clamp-1'
                                                    }, note.title),
                                                    note.reminderDate && React.createElement('span', {
                                                        className: 'text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full'
                                                    },
                                                        React.createElement('i', { className: 'fa-regular fa-clock mr-1' }),
                                                        new Date(note.reminderDate).toLocaleDateString('pt-BR')
                                                    )
                                                ),
                                                React.createElement('p', {
                                                    className: 'text-gray-600 text-sm whitespace-pre-wrap line-clamp-5'
                                                }, note.content || 'Sem conteúdo...')
                                            ),
                                            
                                            React.createElement('div', {
                                                className: 'bg-gray-50 px-5 py-3 border-t'
                                            },
                                                React.createElement('div', {
                                                    className: 'flex justify-between items-center text-xs text-gray-500'
                                                },
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-3'
                                                    },
                                                        React.createElement('span', {
                                                            className: 'flex items-center gap-1'
                                                        },
                                                            React.createElement('i', { className: 'fa-regular fa-eye' }),
                                                            note.viewCount || 0
                                                        ),
                                                        React.createElement('span', {
                                                            className: 'flex items-center gap-1'
                                                        },
                                                            React.createElement('i', { className: 'fa-regular fa-comment' }),
                                                            comments.filter(c => c.noteId === note.id).length
                                                        ),
                                                        React.createElement('button', {
                                                            onClick: (e) => handleLikeNote(note.id, e),
                                                            className: 'flex items-center gap-1 hover:text-red-500'
                                                        },
                                                            React.createElement('i', { 
                                                                className: `fa-regular fa-heart ${note.liked ? 'text-red-500' : ''}`
                                                            }),
                                                            note.likeCount || 0
                                                        )
                                                    ),
                                                    React.createElement('div', {
                                                        className: 'text-right'
                                                    },
                                                        React.createElement('div', {
                                                            className: 'font-medium'
                                                        }, note.author),
                                                        React.createElement('div', {
                                                            className: 'text-[10px]'
                                                        }, `Atualizada: ${utils.formatDate(note.updatedAt)}`)
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),
                
                // Modal de Autenticação
                React.createElement(Modal, {
                    isOpen: showAuthModal,
                    title: "Bem-vindo ao ColabNotes",
                    onClose: () => {}
                },
                    React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'text-center' },
                            React.createElement('div', {
                                className: 'bg-blue-600 text-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4'
                            },
                                React.createElement('i', { className: 'fa-solid fa-users text-2xl' })
                            ),
                            React.createElement('h2', {
                                className: 'text-2xl font-bold text-gray-800 mb-2'
                            }, 'ColabNotes'),
                            React.createElement('p', { className: 'text-gray-600' }, 'Notas colaborativas em tempo real')
                        ),
                        
                        React.createElement('form', {
                            onSubmit: handleAuth,
                            className: 'space-y-4'
                        },
                            React.createElement('div', null,
                                React.createElement('label', {
                                    className: 'block text-sm font-medium text-gray-700 mb-1'
                                }, 'Como quer ser chamado?'),
                                React.createElement('input', {
                                    type: 'text',
                                    className: 'w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none',
                                    placeholder: 'Seu nome ou apelido',
                                    value: username,
                                    onChange: (e) => setUsername(e.target.value),
                                    required: true
                                })
                            ),
                            
                            React.createElement('button', {
                                type: 'submit',
                                className: 'w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700'
                            }, 'Entrar no ColabNotes')
                        ),
                        
                        React.createElement('div', { className: 'text-center text-sm text-gray-500' },
                            'Como visitante, você pode ver e colaborar em todas as notas públicas!'
                        )
                    )
                ),
                
                // Modal de Configurações
                React.createElement(Modal, {
                    isOpen: isSettingsOpen,
                    title: "Configurações",
                    onClose: () => setIsSettingsOpen(false)
                },
                    React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg' },
                            React.createElement('h4', {
                                className: 'font-bold text-gray-700 mb-2'
                            },
                                React.createElement('i', { className: 'fa-solid fa-user-circle mr-2' }),
                                'Sua Conta'
                            ),
                            React.createElement('div', { className: 'space-y-2' },
                                React.createElement('div', { className: 'flex justify-between' },
                                    React.createElement('span', { className: 'text-gray-600' }, 'Nome:'),
                                    React.createElement('span', { className: 'font-medium' }, username)
                                ),
                                React.createElement('div', { className: 'flex justify-between' },
                                    React.createElement('span', { className: 'text-gray-600' }, 'Status:'),
                                    React.createElement('span', {
                                        className: 'font-medium px-2 py-1 rounded text-xs bg-green-100 text-green-800'
                                    },
                                        React.createElement('i', { 
                                            className: 'fa-solid fa-circle mr-1',
                                            style: { fontSize: '6px' }
                                        }),
                                        'Online'
                                    )
                                )
                            )
                        ),
                        
                        React.createElement('div', { className: 'text-center' },
                            React.createElement('button', {
                                onClick: () => {
                                    if (confirm("Deseja sair do ColabNotes?")) {
                                        handleLogout();
                                    }
                                },
                                className: 'bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium'
                            },
                                React.createElement('i', { className: 'fa-solid fa-right-from-bracket mr-2' }),
                                'Sair do App'
                            )
                        )
                    )
                ),
                
                // Modal da Nota (Editor)
                isNoteModalOpen && React.createElement('div', {
                    className: 'fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4 fade-in'
                },
                    React.createElement('div', {
                        className: 'bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col'
                    },
                        // Cabeçalho do modal
                        React.createElement('div', {
                            className: 'p-4 border-b flex justify-between items-center'
                        },
                            React.createElement('div', null,
                                React.createElement('h2', {
                                    className: 'font-bold text-lg text-gray-700'
                                }, activeNote ? 'Editar Nota' : 'Nova Nota'),
                                React.createElement('div', {
                                    className: 'text-xs text-gray-500 flex items-center gap-2 mt-1'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-users' }),
                                    'Esta nota é pública e colaborativa'
                                )
                            ),
                            React.createElement('div', { className: 'flex gap-2' },
                                activeNote && React.createElement('button', {
                                    onClick: () => handleDeleteNote(activeNote.id),
                                    className: 'p-2 text-red-500 hover:bg-red-50 rounded',
                                    title: 'Excluir'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-trash' })
                                ),
                                React.createElement('button', {
                                    onClick: closeNoteModal,
                                    className: 'p-2 text-gray-500 hover:bg-gray-200 rounded'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-times text-xl' })
                                )
                            )
                        ),
                        
                        // Corpo do modal
                        React.createElement('div', {
                            className: 'flex-1 overflow-hidden flex flex-col md:flex-row'
                        },
                            // Editor (esquerda)
                            React.createElement('div', {
                                className: 'flex-1 p-6 border-r overflow-y-auto'
                            },
                                React.createElement('div', {
                                    className: 'flex items-center gap-2 mb-4 text-sm text-gray-600'
                                },
                                    React.createElement('div', {
                                        className: 'w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold',
                                        style: { backgroundColor: userColor }
                                    },
                                        username.charAt(0).toUpperCase()
                                    ),
                                    React.createElement('span', null,
                                        'Editando como ',
                                        React.createElement('strong', null, username)
                                    )
                                ),
                                
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: 'Título da Nota (visível para todos)',
                                    className: 'w-full text-2xl font-bold mb-4 outline-none placeholder-gray-300',
                                    value: formTitle,
                                    onChange: (e) => setFormTitle(e.target.value)
                                }),
                                
                                React.createElement('textarea', {
                                    placeholder: 'Escreva seu conteúdo aqui... Todos os usuários podem ver e editar.',
                                    className: 'w-full h-64 resize-none outline-none text-gray-700',
                                    value: formContent,
                                    onChange: (e) => setFormContent(e.target.value)
                                }),
                                
                                React.createElement('div', {
                                    className: 'mt-4 text-xs text-gray-500'
                                },
                                    React.createElement('i', { className: 'fa-solid fa-info-circle mr-1' }),
                                    `Esta nota será visível para todos os ${onlineUsers.length + 1} usuários online`
                                )
                            ),
                            
                            // Comentários (direita)
                            React.createElement('div', {
                                className: 'w-full md:w-96 flex flex-col border-t md:border-t-0'
                            },
                                React.createElement('div', {
                                    className: 'p-4 border-b'
                                },
                                    React.createElement('h3', {
                                        className: 'font-bold text-gray-700'
                                    },
                                        React.createElement('i', { className: 'fa-regular fa-comments mr-2' }),
                                        'Discussão ',
                                        React.createElement('span', {
                                            className: 'bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full ml-2'
                                        }, activeComments.length)
                                    )
                                ),
                                
                                React.createElement('div', {
                                    className: 'flex-1 overflow-y-auto p-4 space-y-3'
                                },
                                    activeComments.length === 0 ? (
                                        React.createElement('div', {
                                            className: 'text-center text-gray-400 py-8'
                                        },
                                            React.createElement('i', {
                                                className: 'fa-regular fa-comment-dots text-3xl mb-2'
                                            }),
                                            React.createElement('p', null, 'Seja o primeiro a comentar!'),
                                            React.createElement('p', {
                                                className: 'text-xs mt-1'
                                            }, 'Use os comentários para discutir esta nota com outros')
                                        )
                                    ) : (
                                        activeComments.map(comment => 
                                            React.createElement('div', {
                                                key: comment.id,
                                                className: 'bg-white p-3 rounded-lg shadow-sm border border-gray-100'
                                            },
                                                React.createElement('div', {
                                                    className: 'flex justify-between items-baseline mb-1'
                                                },
                                                    React.createElement('span', {
                                                        className: 'font-semibold text-xs text-gray-700'
                                                    }, comment.author),
                                                    React.createElement('span', {
                                                        className: 'text-[10px] text-gray-400'
                                                    }, utils.formatDate(comment.createdAt))
                                                ),
                                                React.createElement('p', {
                                                    className: 'text-gray-700 text-sm'
                                                }, comment.content)
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('div', {
                                    className: 'p-3 border-t'
                                },
                                    React.createElement('div', { className: 'flex gap-2' },
                                        React.createElement('input', {
                                            type: 'text',
                                            placeholder: 'Adicione um comentário...',
                                            className: 'flex-1 border rounded-full px-3 py-2 text-sm focus:outline-none focus:border-blue-500',
                                            value: newComment,
                                            onChange: (e) => setNewComment(e.target.value),
                                            onKeyPress: (e) => e.key === 'Enter' && handleSendComment()
                                        }),
                                        React.createElement('button', {
                                            onClick: handleSendComment,
                                            className: 'bg-blue-600 text-white w-9 h-9 rounded-full flex items-center justify-center hover:bg-blue-700',
                                            disabled: !newComment.trim()
                                        },
                                            React.createElement('i', { className: 'fa-solid fa-paper-plane text-xs' })
                                        )
                                    )
                                )
                            )
                        ),
                        
                        // Rodapé do modal
                        React.createElement('div', {
                            className: 'p-4 border-t flex justify-end'
                        },
                            React.createElement('button', {
                                onClick: handleSaveNote,
                                className: 'bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2'
                            },
                                React.createElement('i', { className: 'fa-solid fa-save' }),
                                activeNote ? 'Salvar Alterações' : 'Publicar Nota'
                            )
                        )
                    )
                )
            );
        }

        // ============================================
        // INICIALIZAÇÃO DO APP
        // ============================================
        
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(App));
            console.log("ColabNotes iniciado com sucesso!");
        } catch (error) {
            console.error("Erro ao iniciar app:", error);
            document.getElementById('root').innerHTML = `
                <div class="flex h-screen items-center justify-center">
                    <div class="text-center">
                        <div class="text-red-500 text-6xl mb-4">⚠️</div>
                        <h1 class="text-2xl font-bold text-gray-800 mb-2">Erro ao carregar</h1>
                        <p class="text-gray-600 mb-4">Recarregue a página ou tente novamente.</p>
                        <button onclick="window.location.reload()" class="bg-blue-600 text-white px-6 py-2 rounded-lg">
                            Recarregar Página
                        </button>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
