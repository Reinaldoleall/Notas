<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes - Bloco de Notas</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    borderWidth: {
                        '3': '3px'
                    }
                }
            }
        }
    </script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs (ATUALIZADO) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); 
            min-height: 100vh;
            margin: 0;
        }
        
        /* Spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        .spinner-small {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Anima√ß√µes */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Scrollbar personalizada */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Efeitos de card */
        .note-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        
        .note-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        /* Indicador online */
        .online-indicator {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            animation: pulse-green 2s infinite;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        /* Gradientes */
        .gradient-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        /* Efeito de brilho */
        .glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        /* Modal backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
        }
        
        /* Utilit√°rios */
        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
        }
        
        .line-clamp-5 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 5;
        }
        
        .z-50 {
            z-index: 50;
        }
        
        .z-10 {
            z-index: 10;
        }
        
        /* Tela de login espec√≠fica */
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 100%;
            max-width: 500px;
            animation: slideUp 0.5s ease-out;
        }
        
        .login-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .login-body {
            padding: 40px 30px;
        }
    </style>
</head>
<body class="antialiased">
    <div id="root"></div>

    <script type="text/babel">
        try {
            // ============================================
            // CONFIGURA√á√ÉO FIREBASE
            // ============================================
            const firebaseConfig = {
                apiKey: "AIzaSyAS2tOdf-Xjq5lRHeKC_Fjx0tSoMyCKkas",
                authDomain: "notas-c6160.firebaseapp.com",
                projectId: "notas-c6160",
                storageBucket: "notas-c6160.firebasestorage.app",
                messagingSenderId: "963622058510",
                appId: "1:963622058510:web:4d7c1c7e1d02c837811a5f",
                measurementId: "G-B6H79DLBNR"
            };

            // Inicializa Firebase com try-catch
            let auth, db;
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                auth = firebase.auth();
                db = firebase.firestore();
                console.log("‚úÖ Firebase inicializado com sucesso!");
            } catch (firebaseError) {
                console.error("‚ùå Erro ao inicializar Firebase:", firebaseError);
                throw new Error("Falha na inicializa√ß√£o do Firebase. Verifique sua conex√£o.");
            }

            // ============================================
            // FUN√á√ïES UTILIT√ÅRIAS
            // ============================================
            const formatDate = (timestamp) => {
                try {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 1) return 'agora mesmo';
                    if (diffMins < 60) return `h√° ${diffMins} min`;
                    if (diffHours < 24) return `h√° ${diffHours}h`;
                    if (diffDays < 7) return `h√° ${diffDays}d`;
                    
                    return date.toLocaleDateString('pt-BR', { 
                        day: '2-digit', 
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    return '';
                }
            };

            const formatDateFull = (timestamp) => {
                try {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return date.toLocaleDateString('pt-BR', { 
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                } catch (e) {
                    return '';
                }
            };

            const getGoogleCalendarUrl = (note) => {
                try {
                    if (!note.reminderDate) return '#';
                    
                    const startDate = new Date(note.reminderDate).toISOString().replace(/-|:|\.\d\d\d/g, "");
                    const endDate = new Date(new Date(note.reminderDate).getTime() + 60*60*1000).toISOString().replace(/-|:|\.\d\d\d/g, "");
                    
                    const title = encodeURIComponent(note.title || 'Nota sem t√≠tulo');
                    const details = encodeURIComponent((note.content || '') + "\n\n(Criado via ColabNotes)");
                    
                    return `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startDate}/${endDate}&details=${details}`;
                } catch (e) {
                    return '#';
                }
            };

            const sendBrowserNotification = (title, body) => {
                try {
                    if (!("Notification" in window)) return;
                    
                    if (Notification.permission === "granted") {
                        new Notification(title, { 
                            body, 
                            icon: "https://cdn-icons-png.flaticon.com/512/2965/2965358.png"
                        });
                    } else if (Notification.permission !== "denied") {
                        Notification.requestPermission().then(permission => {
                            if (permission === "granted") {
                                new Notification(title, { body });
                            }
                        });
                    }
                } catch (e) {
                    console.warn("Erro ao enviar notifica√ß√£o:", e);
                }
            };

            const generateUserColor = (userId) => {
                try {
                    const colors = [
                        '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                        '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1',
                        '#14b8a6', '#f43f5e', '#8b5cf6', '#0ea5e9', '#84cc16'
                    ];
                    if (!userId) return colors[0];
                    const hash = userId.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                    return colors[hash % colors.length];
                } catch (e) {
                    return '#3b82f6';
                }
            };

            const getInitials = (name) => {
                try {
                    if (!name) return '?';
                    return name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
                } catch (e) {
                    return '??';
                }
            };

            // ============================================
            // COMPONENTE MODAL
            // ============================================
            const Modal = ({ isOpen, onClose, title, children, size = 'md', showClose = true }) => {
                if (!isOpen) return null;
                
                const sizeClasses = {
                    sm: 'max-w-md',
                    md: 'max-w-lg',
                    lg: 'max-w-2xl',
                    xl: 'max-w-4xl',
                    full: 'max-w-6xl'
                };
                
                return ReactDOM.createPortal(
                    <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4 fade-in">
                        <div className={`bg-white rounded-2xl shadow-2xl w-full ${sizeClasses[size]} overflow-hidden slide-up`}>
                            <div className="flex justify-between items-center p-6 border-b border-gray-100">
                                <h3 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    {title}
                                </h3>
                                {showClose && (
                                    <button 
                                        onClick={onClose}
                                        className="text-gray-400 hover:text-gray-600 hover:bg-gray-100 w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200"
                                    >
                                        <i className="fa-solid fa-times text-lg"></i>
                                    </button>
                                )}
                            </div>
                            <div className="p-6 max-h-[80vh] overflow-y-auto custom-scrollbar">
                                {children}
                            </div>
                        </div>
                    </div>,
                    document.body
                );
            };

            // ============================================
            // COMPONENTE LOGIN SCREEN (TELA INICIAL)
            // ============================================
            const LoginScreen = ({ onLoginSuccess }) => {
                const [name, setName] = React.useState('');
                const [email, setEmail] = React.useState('');
                const [password, setPassword] = React.useState('');
                const [isLogin, setIsLogin] = React.useState(true);
                const [loading, setLoading] = React.useState(false);
                const [error, setError] = React.useState('');
                const [showEmailLogin, setShowEmailLogin] = React.useState(false);
                const [isProcessing, setIsProcessing] = React.useState(false);

                const handleEmailSubmit = async (e) => {
                    e.preventDefault();
                    if (isProcessing) return;
                    
                    setIsProcessing(true);
                    setLoading(true);
                    setError('');

                    try {
                        if (isLogin) {
                            console.log("Tentando login com email:", email);
                            await auth.signInWithEmailAndPassword(email, password);
                            console.log("Login bem-sucedido!");
                        } else {
                            if (password.length < 6) {
                                throw new Error('A senha deve ter pelo menos 6 caracteres');
                            }
                            
                            console.log("Tentando cadastro com email:", email);
                            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                            console.log("Cadastro bem-sucedido!");
                            
                            if (name.trim()) {
                                await userCredential.user.updateProfile({
                                    displayName: name
                                });
                                
                                await db.collection('users').doc(userCredential.user.uid).set({
                                    name: name.trim(),
                                    email: email,
                                    lastSeen: Date.now(),
                                    color: generateUserColor(userCredential.user.uid),
                                    createdAt: Date.now()
                                }, { merge: true });
                            }
                        }
                        
                        onLoginSuccess();
                    } catch (err) {
                        console.error("Erro de autentica√ß√£o:", err);
                        let errorMessage = 'Erro ao autenticar';
                        
                        if (err.code === 'auth/invalid-email') {
                            errorMessage = 'Email inv√°lido';
                        } else if (err.code === 'auth/user-disabled') {
                            errorMessage = 'Conta desativada';
                        } else if (err.code === 'auth/user-not-found') {
                            errorMessage = 'Usu√°rio n√£o encontrado';
                        } else if (err.code === 'auth/wrong-password') {
                            errorMessage = 'Senha incorreta';
                        } else if (err.code === 'auth/email-already-in-use') {
                            errorMessage = 'Email j√° est√° em uso';
                        } else if (err.code === 'auth/weak-password') {
                            errorMessage = 'Senha muito fraca';
                        } else if (err.code === 'auth/network-request-failed') {
                            errorMessage = 'Erro de conex√£o. Verifique sua internet';
                        } else {
                            errorMessage = err.message;
                        }
                        
                        setError(errorMessage);
                    } finally {
                        setIsProcessing(false);
                        setLoading(false);
                    }
                };

                const handleGoogleLogin = async () => {
                    if (isProcessing) return;
                    
                    setIsProcessing(true);
                    try {
                        const provider = new firebase.auth.GoogleAuthProvider();
                        provider.addScope('profile');
                        provider.addScope('email');
                        console.log("Tentando login com Google...");
                        await auth.signInWithPopup(provider);
                        console.log("Login com Google bem-sucedido!");
                        onLoginSuccess();
                    } catch (err) {
                        console.error("Erro no login com Google:", err);
                        setError('Erro ao fazer login com Google. Tente novamente.');
                    } finally {
                        setIsProcessing(false);
                    }
                };

                const handleAnonymousLogin = async () => {
                    if (isProcessing) return;
                    
                    setIsProcessing(true);
                    try {
                        console.log("Tentando login an√¥nimo...");
                        await auth.signInAnonymously();
                        console.log("Login an√¥nimo bem-sucedido!");
                        onLoginSuccess();
                    } catch (err) {
                        console.error("Erro no login an√¥nimo:", err);
                        setError('Erro ao fazer login como visitante. Tente novamente.');
                    } finally {
                        setIsProcessing(false);
                    }
                };

                const handleGitHubLogin = async () => {
                    if (isProcessing) return;
                    
                    setIsProcessing(true);
                    try {
                        const provider = new firebase.auth.GithubAuthProvider();
                        console.log("Tentando login com GitHub...");
                        await auth.signInWithPopup(provider);
                        console.log("Login com GitHub bem-sucedido!");
                        onLoginSuccess();
                    } catch (err) {
                        console.error("Erro no login com GitHub:", err);
                        setError('Erro ao fazer login com GitHub. Tente novamente.');
                    } finally {
                        setIsProcessing(false);
                    }
                };

                return (
                    <div className="login-container">
                        <div className="login-card">
                            <div className="login-header">
                                <div className="w-24 h-24 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i className="fa-solid fa-users text-4xl text-white"></i>
                                </div>
                                <h1 className="text-3xl font-bold mb-2">Padula - Notes</h1>
                                <p className="text-white/90">Notas colaborativas em tempo real</p>
                            </div>
                            
                            <div className="login-body">
                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl flex items-start gap-3 mb-6">
                                        <i className="fa-solid fa-triangle-exclamation mt-0.5"></i>
                                        <div>
                                            <p className="font-medium">Erro de autentica√ß√£o</p>
                                            <p className="text-sm">{error}</p>
                                        </div>
                                    </div>
                                )}

                                {!showEmailLogin ? (
                                    <>
                                        <div className="text-center mb-8">
                                            <h2 className="text-2xl font-bold text-gray-800 mb-2">
                                                {isLogin ? 'Bem-vindo de volta!' : 'Crie sua conta'}
                                            </h2>
                                            <p className="text-gray-600">
                                                {isLogin ? 'Entre para colaborar em tempo real' : 'Junte-se √† comunidade colaborativa'}
                                            </p>
                                        </div>

                                        <div className="space-y-4 mb-8">
                                            <button
                                                onClick={handleGoogleLogin}
                                                disabled={isProcessing}
                                                className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 px-4 py-4 rounded-xl hover:bg-gray-50 transition-all duration-200 shadow-sm hover:shadow disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                <i className="fa-brands fa-google text-red-500 text-lg"></i>
                                               
                                            </button>
                                            
                                            <button
                                                onClick={handleGitHubLogin}
                                                disabled={isProcessing}
                                                className="w-full flex items-center justify-center gap-3 bg-gray-800 text-white px-4 py-4 rounded-xl hover:bg-gray-900 transition-all duration-200 shadow-sm hover:shadow disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                <i className="fa-brands fa-github text-lg"></i>
                                              
                                            </button>

                                            <button
                                                onClick={handleAnonymousLogin}
                                                disabled={isProcessing}
                                                className="w-full flex items-center justify-center gap-3 bg-gray-100 text-gray-700 px-4 py-4 rounded-xl hover:bg-gray-200 transition-all duration-200 border border-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                <i className="fa-solid fa-user-secret"></i>
                                             
                                            </button>
                                        </div>

                                        <div className="relative mb-8">
                                            <div className="absolute inset-0 flex items-center">
                                                <div className="w-full border-t border-gray-300"></div>
                                            </div>
                                            <div className="relative flex justify-center">
                                                <button
                                                    onClick={() => setShowEmailLogin(true)}
                                                    disabled={isProcessing}
                                                    className="bg-white px-4 text-sm text-gray-600 hover:text-gray-800 font-medium disabled:opacity-50"
                                                >
                                                    Ou entre com email
                                                </button>
                                            </div>
                                        </div>

                                        <div className="text-center">
                                            <button
                                                onClick={() => setIsLogin(!isLogin)}
                                                disabled={isProcessing}
                                                className="text-blue-600 hover:text-blue-800 font-medium disabled:opacity-50"
                                            >
                                                {isLogin ? 'N√£o tem conta? Crie uma agora' : 'J√° tem conta? Fa√ßa login'}
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    <form onSubmit={handleEmailSubmit} className="space-y-6">
                                        <div className="text-center mb-6">
                                            <h2 className="text-2xl font-bold text-gray-800 mb-2">
                                                {isLogin ? 'Entrar com Email' : 'Criar Conta'}
                                            </h2>
                                            <p className="text-gray-600">
                                                {isLogin ? 'Digite suas credenciais' : 'Preencha seus dados'}
                                            </p>
                                        </div>

                                        {!isLogin && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    <i className="fa-solid fa-user mr-2"></i>
                                                    Seu nome
                                                </label>
                                                <input
                                                    type="text"
                                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                                                    placeholder="Como gostaria de ser chamado?"
                                                    value={name}
                                                    onChange={(e) => setName(e.target.value)}
                                                    required={!isLogin}
                                                    disabled={isProcessing}
                                                />
                                            </div>
                                        )}
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                <i className="fa-solid fa-envelope mr-2"></i>
                                                Email
                                            </label>
                                            <input
                                                type="email"
                                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                                                placeholder="seu@email.com"
                                                value={email}
                                                onChange={(e) => setEmail(e.target.value)}
                                                required
                                                disabled={isProcessing}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                <i className="fa-solid fa-lock mr-2"></i>
                                                Senha
                                            </label>
                                            <input
                                                type="password"
                                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                                                placeholder={isLogin ? "Sua senha" : "M√≠nimo 6 caracteres"}
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                required
                                                minLength={isLogin ? undefined : 6}
                                                disabled={isProcessing}
                                            />
                                        </div>

                                        <button
                                            type="submit"
                                            disabled={loading || isProcessing}
                                            className="w-full gradient-primary text-white py-4 rounded-xl font-bold hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-3"
                                        >
                                            {loading ? (
                                                <>
                                                    <div className="spinner-small"></div>
                                                    {isLogin ? 'Entrando...' : 'Criando conta...'}
                                                </>
                                            ) : (
                                                <>
                                                    <i className={`fa-solid ${isLogin ? 'fa-sign-in-alt' : 'fa-user-plus'}`}></i>
                                                    {isLogin ? 'Entrar' : 'Criar Conta'}
                                                </>
                                            )}
                                        </button>

                                        <div className="text-center space-y-3">
                                            <button
                                                onClick={() => setShowEmailLogin(false)}
                                                disabled={isProcessing}
                                                className="text-gray-600 hover:text-gray-800 font-medium disabled:opacity-50"
                                            >
                                                ‚Üê Voltar para outras op√ß√µes
                                            </button>
                                            
                                            <div>
                                                <button
                                                    onClick={() => setIsLogin(!isLogin)}
                                                    disabled={isProcessing}
                                                    className="text-blue-600 hover:text-blue-800 font-medium disabled:opacity-50"
                                                >
                                                    {isLogin ? 'N√£o tem conta? Registre-se' : 'J√° tem conta? Fa√ßa login'}
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // ============================================
            // COMPONENTE ONLINE USERS
            // ============================================
            const OnlineUsers = ({ users, currentUser }) => {
                try {
                    const totalUsers = users.length + 1;
                    
                    return (
                        <div className="flex items-center gap-3">
                            <div className="flex items-center gap-2">
                                <div className="online-indicator"></div>
                                <span className="text-sm font-medium text-gray-700">{totalUsers} online</span>
                            </div>
                            
                            <div className="flex -space-x-2">
                                <div className="relative group" title={`${currentUser.name} (Voc√™)`}>
                                    <div 
                                        className="w-10 h-10 rounded-full border-3 border-white flex items-center justify-center text-white font-bold text-sm shadow-lg transition-transform group-hover:scale-110"
                                        style={{ backgroundColor: currentUser.color }}
                                    >
                                        {getInitials(currentUser.name)}
                                    </div>
                                    <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                                </div>
                                
                                {users.slice(0, 4).map(user => (
                                    <div key={user.id} className="relative group" title={user.name}>
                                        <div 
                                            className="w-10 h-10 rounded-full border-3 border-white flex items-center justify-center text-white font-bold text-sm shadow-lg transition-transform group-hover:scale-110"
                                            style={{ backgroundColor: user.color || generateUserColor(user.id) }}
                                        >
                                            {getInitials(user.name)}
                                        </div>
                                        <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                                    </div>
                                ))}
                                
                                {users.length > 4 && (
                                    <div className="relative group">
                                        <div className="w-10 h-10 rounded-full border-3 border-white bg-gray-300 flex items-center justify-center text-gray-700 font-bold text-sm shadow-lg">
                                            +{users.length - 4}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                } catch (error) {
                    console.error("Erro no componente OnlineUsers:", error);
                    return <div>Erro ao carregar usu√°rios</div>;
                }
            };

            // ============================================
            // COMPONENTE PRINCIPAL APP
            // ============================================
            const App = () => {
                // Estados principais
                const [user, setUser] = React.useState(null);
                const [username, setUsername] = React.useState('');
                const [userEmail, setUserEmail] = React.useState('');
                const [notes, setNotes] = React.useState([]);
                const [comments, setComments] = React.useState([]);
                const [onlineUsers, setOnlineUsers] = React.useState([]);
                const [recentActivity, setRecentActivity] = React.useState([]);
                const [loading, setLoading] = React.useState(true);
                const [userColor, setUserColor] = React.useState('#3b82f6');
                const [showLogin, setShowLogin] = React.useState(true);
                
                // Estados UI
                const [isNoteModalOpen, setIsNoteModalOpen] = React.useState(false);
                const [isSettingsOpen, setIsSettingsOpen] = React.useState(false);
                const [isUsersModalOpen, setIsUsersModalOpen] = React.useState(false);
                const [activeNote, setActiveNote] = React.useState(null);
                const [newNoteHighlight, setNewNoteHighlight] = React.useState(null);
                const [activeTab, setActiveTab] = React.useState('all');
                
                // Formul√°rios
                const [formTitle, setFormTitle] = React.useState('');
                const [formContent, setFormContent] = React.useState('');
                const [formDate, setFormDate] = React.useState('');
                const [newComment, setNewComment] = React.useState('');
                
                // Configura√ß√µes
                const [emailConfig, setEmailConfig] = React.useState({
                    serviceId: localStorage.getItem('email_service_id') || '',
                    templateId: localStorage.getItem('email_template_id') || '',
                    publicKey: localStorage.getItem('email_public_key') || ''
                });
                const [notificationEnabled, setNotificationEnabled] = React.useState(
                    localStorage.getItem('notifications_enabled') !== 'false'
                );

                // ============================================
                // USE EFFECTS
                // ============================================

                // Efeito 1: Verificar se j√° est√° autenticado
                React.useEffect(() => {
                    const unsubscribe = auth.onAuthStateChanged(async (u) => {
                        try {
                            setLoading(true);
                            if (u) {
                                console.log("Usu√°rio autenticado detectado:", u.uid);
                                setUser(u);
                                
                                let displayName = u.displayName;
                                let email = u.email;
                                const color = generateUserColor(u.uid);
                                setUserColor(color);
                                
                                if (u.isAnonymous) {
                                    const savedName = localStorage.getItem(`username_${u.uid}`);
                                    if (savedName) {
                                        displayName = savedName;
                                    } else {
                                        displayName = 'Visitante';
                                    }
                                    email = null;
                                } else {
                                    displayName = u.displayName || u.email?.split('@')[0] || 'Usu√°rio';
                                    email = u.email;
                                    
                                    await db.collection('users').doc(u.uid).set({
                                        name: displayName,
                                        email: email,
                                        lastSeen: Date.now(),
                                        color: color,
                                        createdAt: Date.now(),
                                        isAnonymous: false
                                    }, { merge: true });
                                }
                                
                                setUsername(displayName);
                                setUserEmail(email);
                                setShowLogin(false);
                                
                                // Solicita permiss√£o de notifica√ß√£o
                                if (Notification.permission === 'default') {
                                    Notification.requestPermission();
                                }
                            } else {
                                console.log("Nenhum usu√°rio autenticado, mostrando tela de login");
                                setShowLogin(true);
                            }
                        } catch (error) {
                            console.error("Erro no auth state:", error);
                            setShowLogin(true);
                        } finally {
                            setLoading(false);
                        }
                    });

                    return () => unsubscribe();
                }, []);

                // Efeito 2: Atualizar presen√ßa
                React.useEffect(() => {
                    if (!user) return;
                    
                    try {
                        const userRef = db.collection('users').doc(user.uid);
                        
                        const updatePresence = () => {
                            userRef.set({
                                lastSeen: Date.now(),
                                online: true,
                                name: username,
                                color: userColor
                            }, { merge: true }).catch(e => console.warn("Erro ao atualizar presen√ßa:", e));
                        };
                        
                        updatePresence();
                        const interval = setInterval(updatePresence, 25000);
                        
                        const handleBeforeUnload = () => {
                            userRef.set({
                                online: false,
                                lastSeen: Date.now()
                            }, { merge: true }).catch(e => console.warn("Erro no beforeunload:", e));
                        };
                        
                        window.addEventListener('beforeunload', handleBeforeUnload);
                        
                        return () => {
                            clearInterval(interval);
                            window.removeEventListener('beforeunload', handleBeforeUnload);
                            userRef.set({
                                online: false,
                                lastSeen: Date.now()
                            }, { merge: true }).catch(e => console.warn("Erro na limpeza:", e));
                        };
                    } catch (error) {
                        console.error("Erro no efeito de presen√ßa:", error);
                    }
                }, [user, username, userColor]);

                // Efeito 3: Monitorar usu√°rios online
                React.useEffect(() => {
                    if (!user) return;

                    try {
                        const unsub = db.collection('users')
                            .where('lastSeen', '>', Date.now() - 120000)
                            .onSnapshot((snapshot) => {
                                try {
                                    const users = [];
                                    snapshot.forEach(doc => {
                                        if (doc.id !== user.uid) {
                                            users.push({ 
                                                id: doc.id, 
                                                ...doc.data(),
                                                color: doc.data().color || generateUserColor(doc.id)
                                            });
                                        }
                                    });
                                    setOnlineUsers(users);
                                } catch (e) {
                                    console.error("Erro ao processar usu√°rios:", e);
                                }
                            }, (error) => {
                                console.error("Erro no snapshot de usu√°rios:", error);
                            });

                        return () => unsub();
                    } catch (error) {
                        console.error("Erro ao monitorar usu√°rios:", error);
                    }
                }, [user]);

                // Efeito 4: Carregar notas
                React.useEffect(() => {
                    if (!user) return;

                    try {
                        const unsubNotes = db.collection('notes')
                            .orderBy('updatedAt', 'desc')
                            .onSnapshot((snapshot) => {
                                try {
                                    const loadedNotes = [];
                                    snapshot.forEach(doc => {
                                        const note = { id: doc.id, ...doc.data() };
                                        loadedNotes.push(note);
                                    });
                                    
                                    setNotes(loadedNotes);
                                    
                                    // Notifica√ß√µes para novas notas
                                    if (loadedNotes.length > 0 && notificationEnabled) {
                                        const lastNote = loadedNotes[0];
                                        sendBrowserNotification(
                                            "üìù Nova Atividade no ColabNotes!", 
                                            `Agora temos ${loadedNotes.length} notas colaborativas`
                                        );
                                    }
                                } catch (e) {
                                    console.error("Erro ao processar notas:", e);
                                }
                            }, (error) => {
                                console.error("Erro no snapshot de notas:", error);
                            });

                        return () => unsubNotes();
                    } catch (error) {
                        console.error("Erro ao carregar notas:", error);
                    }
                }, [user, notificationEnabled]);

                // Efeito 5: Carregar coment√°rios
                React.useEffect(() => {
                    if (!user) return;

                    try {
                        const unsubComments = db.collection('comments')
                            .orderBy('createdAt', 'desc')
                            .limit(100)
                            .onSnapshot((snapshot) => {
                                try {
                                    const loadedComments = [];
                                    snapshot.forEach(doc => {
                                        loadedComments.push({ id: doc.id, ...doc.data() });
                                    });
                                    
                                    setComments(loadedComments);
                                } catch (e) {
                                    console.error("Erro ao processar coment√°rios:", e);
                                }
                            }, (error) => {
                                console.error("Erro no snapshot de coment√°rios:", error);
                            });

                        return () => unsubComments();
                    } catch (error) {
                        console.error("Erro ao carregar coment√°rios:", error);
                    }
                }, [user]);

                // Efeito 6: Carregar atividade
                React.useEffect(() => {
                    if (!user) return;

                    try {
                        const unsubActivity = db.collection('activity')
                            .orderBy('timestamp', 'desc')
                            .limit(50)
                            .onSnapshot((snapshot) => {
                                try {
                                    const activities = [];
                                    snapshot.forEach(doc => {
                                        activities.push({ id: doc.id, ...doc.data() });
                                    });
                                    setRecentActivity(activities);
                                } catch (e) {
                                    console.error("Erro ao processar atividade:", e);
                                }
                            }, (error) => {
                                console.error("Erro no snapshot de atividade:", error);
                            });

                        return () => unsubActivity();
                    } catch (error) {
                        console.error("Erro ao carregar atividade:", error);
                    }
                }, [user]);

                // ============================================
                // HANDLERS PRINCIPAIS
                // ============================================

                const handleLoginSuccess = () => {
                    console.log("Login realizado com sucesso!");
                    setShowLogin(false);
                };

                const handleLogout = async () => {
                    try {
                        await auth.signOut();
                        setUser(null);
                        setShowLogin(true);
                    } catch (error) {
                        console.error("Erro ao sair:", error);
                        alert("Erro ao fazer logout. Tente novamente.");
                    }
                };

                const handleSaveNote = async () => {
                    if (!formTitle.trim()) {
                        alert("üìù O t√≠tulo da nota √© obrigat√≥rio!");
                        return;
                    }
                    if (!user) {
                        alert("üîí Voc√™ precisa estar autenticado!");
                        return;
                    }

                    const noteData = {
                        title: formTitle,
                        content: formContent,
                        reminderDate: formDate,
                        author: username,
                        authorId: user.uid,
                        updatedAt: Date.now(),
                        lastEditor: username,
                        lastEditorId: user.uid,
                        lastEditedAt: Date.now()
                    };

                    try {
                        if (activeNote) {
                            // Editar
                            await db.collection('notes').doc(activeNote.id).update(noteData);
                            
                            // Registrar atividade
                            await db.collection('activity').add({
                                type: 'edit_note',
                                userId: user.uid,
                                userName: username,
                                noteId: activeNote.id,
                                noteTitle: formTitle,
                                timestamp: Date.now()
                            });
                        } else {
                            // Criar nova
                            noteData.createdAt = Date.now();
                            noteData.viewCount = 0;
                            noteData.likeCount = 0;
                            noteData.commentCount = 0;
                            noteData.collaborators = [user.uid];
                            noteData.isPinned = false;
                            noteData.tags = [];
                            
                            const docRef = await db.collection('notes').add(noteData);
                            
                            // Registrar atividade
                            await db.collection('activity').add({
                                type: 'create_note',
                                userId: user.uid,
                                userName: username,
                                noteId: docRef.id,
                                noteTitle: formTitle,
                                timestamp: Date.now()
                            });
                        }
                        
                        closeNoteModal();
                    } catch (err) {
                        console.error("‚ùå Erro ao salvar:", err);
                        alert("‚ùå Erro ao salvar nota. Tente novamente.");
                    }
                };

                const handleDeleteNote = async (id) => {
                    if (!confirm("üóëÔ∏è Excluir esta nota permanentemente?\nTodos os coment√°rios tamb√©m ser√£o removidos.")) {
                        return;
                    }
                    
                    try {
                        await db.collection('notes').doc(id).delete();
                        
                        // Deletar coment√°rios relacionados
                        const commentsSnapshot = await db.collection('comments')
                            .where('noteId', '==', id)
                            .get();
                        
                        const deletePromises = [];
                        commentsSnapshot.forEach(doc => {
                            deletePromises.push(doc.ref.delete());
                        });
                        await Promise.all(deletePromises);
                        
                        // Registrar atividade
                        await db.collection('activity').add({
                            type: 'delete_note',
                            userId: user.uid,
                            userName: username,
                            noteId: id,
                            timestamp: Date.now()
                        });
                        
                        if (activeNote && activeNote.id === id) {
                            closeNoteModal();
                        }
                    } catch (err) {
                        console.error("‚ùå Erro ao excluir:", err);
                        alert("‚ùå Erro ao excluir nota.");
                    }
                };

                const handleSendComment = async () => {
                    if (!newComment.trim() || !activeNote || !user) return;

                    const commentData = {
                        noteId: activeNote.id,
                        content: newComment,
                        author: username,
                        authorId: user.uid,
                        createdAt: Date.now(),
                        noteTitle: activeNote.title,
                        userColor: userColor
                    };

                    try {
                        await db.collection('comments').add(commentData);
                        
                        // Atualizar contador na nota
                        await db.collection('notes').doc(activeNote.id).update({
                            commentCount: firebase.firestore.FieldValue.increment(1),
                            updatedAt: Date.now()
                        });
                        
                        // Registrar atividade
                        await db.collection('activity').add({
                            type: 'add_comment',
                            userId: user.uid,
                            userName: username,
                            noteId: activeNote.id,
                            noteTitle: activeNote.title,
                            timestamp: Date.now()
                        });
                        
                        setNewComment('');
                    } catch (err) {
                        console.error("‚ùå Erro ao comentar:", err);
                    }
                };

                const handleLikeNote = async (noteId, e) => {
                    if (e) e.stopPropagation();
                    if (!user) return;
                    
                    try {
                        const likeId = `${noteId}_${user.uid}`;
                        const likeRef = db.collection('likes').doc(likeId);
                        const likeDoc = await likeRef.get();
                        
                        if (likeDoc.exists) {
                            // Remover like
                            await likeRef.delete();
                            await db.collection('notes').doc(noteId).update({
                                likeCount: firebase.firestore.FieldValue.increment(-1)
                            });
                        } else {
                            // Adicionar like
                            await likeRef.set({
                                noteId,
                                userId: user.uid,
                                userName: username,
                                userColor: userColor,
                                createdAt: Date.now()
                            });
                            await db.collection('notes').doc(noteId).update({
                                likeCount: firebase.firestore.FieldValue.increment(1)
                            });
                        }
                    } catch (err) {
                        console.error("‚ùå Erro no like:", err);
                    }
                };

                const handlePinNote = async (noteId, e) => {
                    if (e) e.stopPropagation();
                    if (!user) return;
                    
                    try {
                        const noteRef = db.collection('notes').doc(noteId);
                        const noteDoc = await noteRef.get();
                        const currentPinStatus = noteDoc.data()?.isPinned || false;
                        
                        await noteRef.update({
                            isPinned: !currentPinStatus
                        });
                    } catch (err) {
                        console.error("‚ùå Erro ao fixar:", err);
                    }
                };

                const openNewNote = () => {
                    setFormTitle('');
                    setFormContent('');
                    setFormDate('');
                    setActiveNote(null);
                    setIsNoteModalOpen(true);
                };

                const openEditNote = (note) => {
                    setFormTitle(note.title || '');
                    setFormContent(note.content || '');
                    setFormDate(note.reminderDate || '');
                    setActiveNote(note);
                    setIsNoteModalOpen(true);
                    
                    // Registrar visualiza√ß√£o
                    if (note.authorId !== user?.uid) {
                        db.collection('notes').doc(note.id).update({
                            viewCount: firebase.firestore.FieldValue.increment(1)
                        }).catch(e => console.warn("Erro ao incrementar visualiza√ß√£o:", e));
                    }
                };

                const closeNoteModal = () => {
                    setIsNoteModalOpen(false);
                    setActiveNote(null);
                };

                const toggleNotifications = () => {
                    const newValue = !notificationEnabled;
                    setNotificationEnabled(newValue);
                    localStorage.setItem('notifications_enabled', newValue);
                    
                    if (newValue && Notification.permission === 'default') {
                        Notification.requestPermission();
                    }
                };

                const handleSaveSettings = () => {
                    localStorage.setItem('email_service_id', emailConfig.serviceId);
                    localStorage.setItem('email_template_id', emailConfig.templateId);
                    localStorage.setItem('email_public_key', emailConfig.publicKey);
                    setIsSettingsOpen(false);
                    alert("‚úÖ Configura√ß√µes salvas com sucesso!");
                };

                // ============================================
                // C√ÅLCULOS E FILTROS
                // ============================================

                // Filtrar notas baseado na tab ativa
                const filteredNotes = React.useMemo(() => {
                    try {
                        let filtered = [...notes];
                        
                        switch (activeTab) {
                            case 'my':
                                filtered = filtered.filter(note => note.authorId === user?.uid);
                                break;
                            case 'starred':
                                filtered = filtered.filter(note => note.likeCount > 0);
                                break;
                            case 'pinned':
                                filtered = filtered.filter(note => note.isPinned);
                                break;
                            default:
                                break;
                        }
                        
                        // Ordenar: fixadas primeiro, depois por data
                        return filtered.sort((a, b) => {
                            if (a.isPinned && !b.isPinned) return -1;
                            if (!a.isPinned && b.isPinned) return 1;
                            return (b.updatedAt || 0) - (a.updatedAt || 0);
                        });
                    } catch (e) {
                        console.error("Erro ao filtrar notas:", e);
                        return [];
                    }
                }, [notes, activeTab, user]);

                // Estat√≠sticas
                const userNotesCount = notes.filter(n => n.authorId === user?.uid).length;
                const totalComments = comments.length;
                const totalLikes = notes.reduce((sum, note) => sum + (note.likeCount || 0), 0);
                const pinnedNotesCount = notes.filter(n => n.isPinned).length;
                const activeComments = activeNote ? comments.filter(c => c.noteId === activeNote.id) : [];

                // Usu√°rio atual para componente OnlineUsers
                const currentUser = {
                    id: user?.uid,
                    name: username,
                    color: userColor,
                    isCurrent: true
                };

                // ============================================
                // RENDERIZA√á√ÉO PRINCIPAL
                // ============================================

                // Se est√° carregando
                if (loading) {
                    return (
                        <div className="flex h-screen items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50">
                            <div className="text-center space-y-6">
                                <div className="spinner"></div>
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-2">Carregando ColabNotes</h2>
                                    <p className="text-gray-600">Preparando seu espa√ßo colaborativo...</p>
                                </div>
                            </div>
                        </div>
                    );
                }

                // Se n√£o est√° autenticado, mostra tela de login
                if (showLogin || !user) {
                    return <LoginScreen onLoginSuccess={handleLoginSuccess} />;
                }

                // Renderiza√ß√£o completa do app
                return (
                    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100">
                        {/* Header */}
                        <header className="gradient-header text-white shadow-xl">
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                    {/* Logo e t√≠tulo */}
                                    <div className="flex items-center gap-3">
                                        <div className="bg-white/20 backdrop-blur-sm p-3 rounded-xl">
                                            <i className="fa-solid fa-users text-2xl"></i>
                                        </div>
                                        <div>
                                            <h1 className="text-2xl font-bold">ColabNotes</h1>
                                            <p className="text-white/80 text-sm">Notas colaborativas em tempo real</p>
                                        </div>
                                    </div>
                                    
                                    {/* Usu√°rios online e a√ß√µes */}
                                    <div className="flex flex-col md:flex-row items-start md:items-center gap-4 w-full md:w-auto">
                                        <div className="flex-1 md:flex-none">
                                            <OnlineUsers 
                                                users={onlineUsers} 
                                                currentUser={currentUser} 
                                            />
                                        </div>
                                        
                                        <div className="flex items-center gap-2">
                                            <button
                                                onClick={() => setIsUsersModalOpen(true)}
                                                className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition-all"
                                            >
                                                <i className="fa-solid fa-user-group"></i>
                                                <span className="hidden md:inline">Usu√°rios</span>
                                            </button>
                                            
                                            <button
                                                onClick={() => setIsSettingsOpen(true)}
                                                className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition-all"
                                            >
                                                <i className="fa-solid fa-gear"></i>
                                                <span className="hidden md:inline">Config</span>
                                            </button>
                                            
                                            <button
                                                onClick={handleLogout}
                                                className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition-all"
                                                title="Sair"
                                            >
                                                <i className="fa-solid fa-right-from-bracket"></i>
                                                <span className="hidden md:inline">Sair</span>
                                            </button>
                                            
                                            <button
                                                onClick={openNewNote}
                                                className="gradient-primary hover:opacity-90 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all flex items-center gap-2 glow"
                                            >
                                                <i className="fa-solid fa-plus"></i>
                                                <span className="hidden md:inline">Nova Nota</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Tabs de filtro */}
                                <div className="mt-6 flex flex-wrap gap-2">
                                    {[
                                        { id: 'all', label: 'Todas', icon: 'layer-group', count: notes.length },
                                        { id: 'my', label: 'Minhas', icon: 'user', count: userNotesCount },
                                        { id: 'pinned', label: 'Fixadas', icon: 'thumbtack', count: pinnedNotesCount },
                                        { id: 'starred', label: 'Populares', icon: 'star', count: notes.filter(n => (n.likeCount || 0) > 0).length }
                                    ].map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all ${
                                                activeTab === tab.id 
                                                ? 'bg-white text-blue-600 shadow-lg' 
                                                : 'bg-white/20 text-white hover:bg-white/30'
                                            }`}
                                        >
                                            <i className={`fa-solid fa-${tab.icon}`}></i>
                                            <span>{tab.label}</span>
                                            {tab.count > 0 && (
                                                <span className={`px-2 py-0.5 rounded-full text-xs ${
                                                    activeTab === tab.id 
                                                    ? 'bg-blue-100 text-blue-600' 
                                                    : 'bg-white/30'
                                                }`}>
                                                    {tab.count}
                                                </span>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </header>

                        {/* Conte√∫do principal */}
                        <main className="max-w-7xl mx-auto px-4 py-8">
                            {/* Cards de estat√≠sticas */}
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                {[
                                    { 
                                        title: 'Total de Notas', 
                                        value: notes.length, 
                                        icon: 'note-sticky', 
                                        color: 'blue',
                                        change: '+12%'
                                    },
                                    { 
                                        title: 'Coment√°rios', 
                                        value: totalComments, 
                                        icon: 'comments', 
                                        color: 'green',
                                        change: '+23%'
                                    },
                                    { 
                                        title: 'Likes', 
                                        value: totalLikes, 
                                        icon: 'heart', 
                                        color: 'red',
                                        change: '+18%'
                                    },
                                    { 
                                        title: 'Usu√°rios Online', 
                                        value: onlineUsers.length + 1, 
                                        icon: 'users', 
                                        color: 'purple',
                                        change: 'Ativo'
                                    }
                                ].map((stat, idx) => (
                                    <div key={idx} className="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-all duration-300">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="text-sm text-gray-500 font-medium mb-1">{stat.title}</p>
                                                <p className="text-3xl font-bold text-gray-800">{stat.value}</p>
                                                <p className="text-xs text-gray-400 mt-1">
                                                    <span className={`font-medium ${stat.color === 'blue' ? 'text-blue-600' : stat.color === 'green' ? 'text-green-600' : stat.color === 'red' ? 'text-red-600' : 'text-purple-600'}`}>{stat.change}</span> este m√™s
                                                </p>
                                            </div>
                                            <div className={`${stat.color === 'blue' ? 'bg-blue-100' : stat.color === 'green' ? 'bg-green-100' : stat.color === 'red' ? 'bg-red-100' : 'bg-purple-100'} p-3 rounded-xl`}>
                                                <i className={`fa-solid fa-${stat.icon} ${stat.color === 'blue' ? 'text-blue-600' : stat.color === 'green' ? 'text-green-600' : stat.color === 'red' ? 'text-red-600' : 'text-purple-600'} text-xl`}></i>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Grid de notas */}
                            {filteredNotes.length === 0 ? (
                                <div className="text-center py-16 bg-white rounded-2xl shadow-sm border border-gray-100">
                                    <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <i className="fa-regular fa-folder-open text-4xl text-gray-400"></i>
                                    </div>
                                    <h3 className="text-2xl font-bold text-gray-700 mb-3">
                                        {activeTab === 'my' ? 'Voc√™ ainda n√£o criou notas' : 
                                         activeTab === 'pinned' ? 'Nenhuma nota fixada' :
                                         activeTab === 'starred' ? 'Nenhuma nota com likes' :
                                         'Nenhuma nota ainda'}
                                    </h3>
                                    <p className="text-gray-600 mb-8 max-w-md mx-auto">
                                        {activeTab === 'my' ? 'Crie sua primeira nota e compartilhe com a comunidade!' :
                                         activeTab === 'pinned' ? 'Fixar notas as mant√©m no topo para f√°cil acesso' :
                                         activeTab === 'starred' ? 'D√™ like nas notas que voc√™ gostar!' :
                                         'Seja o primeiro a criar uma nota colaborativa!'}
                                    </p>
                                    <button
                                        onClick={openNewNote}
                                        className="gradient-primary hover:opacity-90 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all text-lg inline-flex items-center gap-3"
                                    >
                                        <i className="fa-solid fa-plus"></i>
                                        Criar Primeira Nota
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-6">
                                    {/* Atividade recente (apenas se houver) */}
                                    {recentActivity.length > 0 && (
                                        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                            <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                                <i className="fa-solid fa-bolt text-yellow-500"></i>
                                                Atividade Recente
                                            </h3>
                                            <div className="space-y-3 max-h-48 overflow-y-auto custom-scrollbar pr-2">
                                                {recentActivity.slice(0, 5).map(activity => (
                                                    <div key={activity.id} className="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                                                        <div 
                                                            className="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0"
                                                            style={{ backgroundColor: generateUserColor(activity.userId) }}
                                                        >
                                                            {getInitials(activity.userName)}
                                                        </div>
                                                        <div className="flex-1 min-w-0">
                                                            <p className="text-sm text-gray-700 truncate">
                                                                <span className="font-semibold">{activity.userName}</span>
                                                                {' '}
                                                                {activity.type === 'create_note' && `criou a nota "${activity.noteTitle}"`}
                                                                {activity.type === 'edit_note' && `editou "${activity.noteTitle}"`}
                                                                {activity.type === 'add_comment' && `comentou em "${activity.noteTitle}"`}
                                                                {activity.type === 'delete_note' && `excluiu uma nota`}
                                                            </p>
                                                            <p className="text-xs text-gray-400">{formatDate(activity.timestamp)}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Grid de notas */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredNotes.map(note => (
                                            <div 
                                                key={note.id}
                                                onClick={() => openEditNote(note)}
                                                className={`bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col h-80 note-card cursor-pointer group relative ${
                                                    newNoteHighlight === note.id ? 'ring-4 ring-blue-500 ring-opacity-50' : ''
                                                }`}
                                            >
                                                {/* Badges */}
                                                {note.isPinned && (
                                                    <div className="absolute top-4 right-4 bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1 z-10">
                                                        <i className="fa-solid fa-thumbtack"></i>
                                                        Fixada
                                                    </div>
                                                )}
                                                
                                                {note.authorId === user?.uid && (
                                                    <div className="absolute top-4 left-4 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1 z-10">
                                                        <i className="fa-solid fa-crown"></i>
                                                        Sua
                                                    </div>
                                                )}
                                                
                                                {/* Lembrete badge */}
                                                {note.reminderDate && new Date(note.reminderDate) > new Date() && (
                                                    <div className="absolute top-12 right-4 bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1 z-10">
                                                        <i className="fa-regular fa-clock"></i>
                                                        {formatDate(note.reminderDate)}
                                                    </div>
                                                )}

                                                {/* Conte√∫do da nota */}
                                                <div className="p-6 flex-1 overflow-hidden">
                                                    <h3 className="font-bold text-lg text-gray-800 mb-3 line-clamp-1 group-hover:text-blue-600 transition-colors">
                                                        {note.title || 'Nota sem t√≠tulo'}
                                                    </h3>
                                                    <div className="text-gray-600 text-sm whitespace-pre-wrap line-clamp-5 mb-4 leading-relaxed">
                                                        {note.content || <span className="text-gray-400 italic">Sem conte√∫do...</span>}
                                                    </div>
                                                </div>

                                                {/* Rodap√© da nota */}
                                                <div className="px-6 py-4 bg-gray-50 border-t border-gray-100">
                                                    <div className="flex justify-between items-center">
                                                        <div className="flex items-center gap-3">
                                                            {/* Views */}
                                                            <span className="flex items-center gap-1 text-xs text-gray-500" title="Visualiza√ß√µes">
                                                                <i className="fa-regular fa-eye"></i>
                                                                <span className="font-medium">{note.viewCount || 0}</span>
                                                            </span>
                                                            
                                                            {/* Comments */}
                                                            <span className="flex items-center gap-1 text-xs text-gray-500" title="Coment√°rios">
                                                                <i className="fa-regular fa-comment"></i>
                                                                <span className="font-medium">{comments.filter(c => c.noteId === note.id).length}</span>
                                                            </span>
                                                            
                                                            {/* Likes */}
                                                            <button 
                                                                onClick={(e) => handleLikeNote(note.id, e)}
                                                                className="flex items-center gap-1 text-xs hover:text-red-500 transition-colors group/like"
                                                                title="Curtir"
                                                            >
                                                                <i className={`fa-regular fa-heart`}></i>
                                                                <span className="font-medium">{note.likeCount || 0}</span>
                                                            </button>
                                                        </div>
                                                        
                                                        <div className="text-right">
                                                            <div className="flex items-center gap-2 justify-end">
                                                                <div 
                                                                    className="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold"
                                                                    style={{ backgroundColor: generateUserColor(note.authorId) }}
                                                                    title={note.author}
                                                                >
                                                                    {getInitials(note.author)}
                                                                </div>
                                                                <div>
                                                                    <p className="text-xs font-medium text-gray-700">{note.author || 'An√¥nimo'}</p>
                                                                    <p className="text-[10px] text-gray-400">{formatDate(note.updatedAt)}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </main>

                        {/* Modais */}
                        <Modal 
                            isOpen={isSettingsOpen}
                            title="‚öôÔ∏è Configura√ß√µes"
                            onClose={() => setIsSettingsOpen(false)}
                            size="lg"
                        >
                            <div className="space-y-6">
                                {/* Configura√ß√µes de notifica√ß√£o */}
                                <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100">
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <h4 className="font-bold text-gray-800 text-lg flex items-center gap-2">
                                                <i className="fa-solid fa-bell"></i>
                                                Notifica√ß√µes
                                            </h4>
                                            <p className="text-sm text-gray-600 mt-1">Receba alertas de novas notas e coment√°rios</p>
                                        </div>
                                        <button
                                            onClick={toggleNotifications}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                notificationEnabled ? 'bg-green-500' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                notificationEnabled ? 'translate-x-6' : 'translate-x-1'
                                            }`} />
                                        </button>
                                    </div>
                                    <p className="text-xs text-gray-500">
                                        Status: {Notification.permission === "granted" ? "‚úÖ Permiss√£o concedida" : "‚ö†Ô∏è Permiss√£o necess√°ria"}
                                    </p>
                                </div>

                                {/* Informa√ß√µes da conta */}
                                <div className="bg-white p-5 rounded-xl border border-gray-200">
                                    <h4 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                        <i className="fa-solid fa-user-circle"></i>
                                        Sua Conta
                                    </h4>
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <div 
                                                    className="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-lg"
                                                    style={{ backgroundColor: userColor }}
                                                >
                                                    {getInitials(username)}
                                                </div>
                                                <div>
                                                    <div className="font-medium text-gray-800">{username}</div>
                                                    <div className="text-sm text-gray-500">{userEmail || 'Usu√°rio an√¥nimo'}</div>
                                                </div>
                                            </div>
                                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${user?.isAnonymous ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}`}>
                                                {user?.isAnonymous ? 'Visitante' : 'Conta registrada'}
                                            </span>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div className="text-center p-3 bg-blue-50 rounded-lg">
                                                <div className="font-bold text-2xl text-blue-600">{userNotesCount}</div>
                                                <div className="text-gray-600">Suas notas</div>
                                            </div>
                                            <div className="text-center p-3 bg-green-50 rounded-lg">
                                                <div className="font-bold text-2xl text-green-600">{comments.filter(c => c.authorId === user?.uid).length}</div>
                                                <div className="text-gray-600">Seus coment√°rios</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* A√ß√µes */}
                                <div className="flex flex-col gap-3">
                                    <button 
                                        onClick={handleSaveSettings}
                                        className="gradient-success text-white py-3 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-save"></i>
                                        Salvar Configura√ß√µes
                                    </button>
                                    
                                    <button 
                                        onClick={handleLogout}
                                        className="bg-gradient-to-r from-red-500 to-pink-500 text-white py-3 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-right-from-bracket"></i>
                                        Sair do ColabNotes
                                    </button>
                                </div>
                            </div>
                        </Modal>

                        <Modal 
                            isOpen={isUsersModalOpen}
                            title="üë• Usu√°rios Online"
                            onClose={() => setIsUsersModalOpen(false)}
                            size="md"
                        >
                            <div className="space-y-6">
                                <div className="text-center">
                                    <div className="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-2 rounded-full">
                                        <div className="online-indicator"></div>
                                        <span className="font-bold">{onlineUsers.length + 1} usu√°rios online</span>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* Voc√™ */}
                                    <div className="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                                        <div className="flex items-center gap-3">
                                            <div 
                                                className="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg relative"
                                                style={{ backgroundColor: userColor }}
                                            >
                                                {getInitials(username)}
                                                <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-3 border-white rounded-full"></div>
                                            </div>
                                            <div>
                                                <div className="font-bold text-gray-800">{username} <span className="text-blue-600">(Voc√™)</span></div>
                                                <div className="text-sm text-gray-600 flex items-center gap-1">
                                                    <i className="fa-solid fa-note-sticky"></i>
                                                    {userNotesCount} notas ‚Ä¢ {comments.filter(c => c.authorId === user?.uid).length} coment√°rios
                                                </div>
                                            </div>
                                        </div>
                                        <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold flex items-center gap-1">
                                            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                            Online
                                        </span>
                                    </div>
                                    
                                    {/* Outros usu√°rios */}
                                    {onlineUsers.map(onlineUser => (
                                        <div key={onlineUser.id} className="flex items-center justify-between p-4 hover:bg-gray-50 rounded-xl transition-colors border border-gray-100">
                                            <div className="flex items-center gap-3">
                                                <div 
                                                    className="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg relative"
                                                    style={{ backgroundColor: onlineUser.color || generateUserColor(onlineUser.id) }}
                                                >
                                                    {getInitials(onlineUser.name)}
                                                    <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-3 border-white rounded-full"></div>
                                                </div>
                                                <div>
                                                    <div className="font-bold text-gray-800">{onlineUser.name}</div>
                                                    <div className="text-sm text-gray-600">
                                                        {onlineUser.email || 'Usu√°rio colaborativo'}
                                                    </div>
                                                </div>
                                            </div>
                                            <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold flex items-center gap-1">
                                                <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                                Online
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </Modal>

                        {/* Modal de Nota */}
                        {isNoteModalOpen && ReactDOM.createPortal(
                            <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
                                    {/* Cabe√ßalho */}
                                    <div className="p-6 border-b border-gray-200 flex justify-between items-center">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                                {activeNote ? (
                                                    <>
                                                        <i className="fa-solid fa-edit text-blue-600"></i>
                                                        Editar Nota
                                                    </>
                                                ) : (
                                                    <>
                                                        <i className="fa-solid fa-plus-circle text-green-600"></i>
                                                        Nova Nota
                                                    </>
                                                )}
                                            </h2>
                                            <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                                                <span className="flex items-center gap-1">
                                                    <i className="fa-solid fa-users"></i>
                                                    P√∫blica e colaborativa
                                                </span>
                                                {activeNote && (
                                                    <>
                                                        <span className="flex items-center gap-1">
                                                            <i className="fa-regular fa-eye"></i>
                                                            {activeNote.viewCount || 0} visualiza√ß√µes
                                                        </span>
                                                        <span className="flex items-center gap-1">
                                                            <i className="fa-regular fa-comment"></i>
                                                            {activeComments.length} coment√°rios
                                                        </span>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            {activeNote && (
                                                <>
                                                    <button 
                                                        onClick={() => handlePinNote(activeNote.id)}
                                                        className={`p-2 rounded-lg ${activeNote.isPinned ? 'text-yellow-600 bg-yellow-50' : 'text-gray-500 hover:text-yellow-600 hover:bg-yellow-50'}`}
                                                        title={activeNote.isPinned ? "Desfixar nota" : "Fixar nota"}
                                                    >
                                                        <i className="fa-solid fa-thumbtack"></i>
                                                    </button>
                                                    <button 
                                                        onClick={() => handleDeleteNote(activeNote.id)}
                                                        className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                        title="Excluir nota"
                                                    >
                                                        <i className="fa-solid fa-trash"></i>
                                                    </button>
                                                </>
                                            )}
                                            <button 
                                                onClick={closeNoteModal}
                                                className="p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors"
                                            >
                                                <i className="fa-solid fa-times text-xl"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Corpo */}
                                    <div className="flex-1 overflow-hidden flex flex-col lg:flex-row">
                                        {/* Editor (esquerda) */}
                                        <div className="flex-1 p-6 border-r border-gray-200 overflow-y-auto custom-scrollbar">
                                            <div className="flex items-center gap-3 mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
                                                <div 
                                                    className="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-lg"
                                                    style={{ backgroundColor: userColor }}
                                                >
                                                    {getInitials(username)}
                                                </div>
                                                <div>
                                                    <div className="font-medium text-gray-800">Editando como <span className="font-bold">{username}</span></div>
                                                    <div className="text-sm text-gray-600">Suas altera√ß√µes ser√£o vis√≠veis para todos</div>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-6">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        T√≠tulo da Nota *
                                                    </label>
                                                    <input 
                                                        type="text" 
                                                        placeholder="D√™ um t√≠tulo claro e descritivo..."
                                                        className="w-full text-3xl font-bold outline-none placeholder-gray-300 bg-transparent"
                                                        value={formTitle}
                                                        onChange={(e) => setFormTitle(e.target.value)}
                                                        autoFocus
                                                    />
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                                            <i className="fa-regular fa-clock"></i>
                                                            Data do Lembrete
                                                        </label>
                                                        <input 
                                                            type="datetime-local" 
                                                            className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                                                            value={formDate}
                                                            onChange={(e) => setFormDate(e.target.value)}
                                                        />
                                                    </div>
                                                    
                                                    {activeNote && formDate && (
                                                        <div className="flex items-end">
                                                            <a 
                                                                href={getGoogleCalendarUrl({title: formTitle, content: formContent, reminderDate: formDate})} 
                                                                target="_blank"
                                                                className="flex items-center gap-2 text-blue-600 hover:text-blue-800 bg-blue-50 px-4 py-3 rounded-xl transition-all hover:bg-blue-100 w-full"
                                                            >
                                                                <i className="fa-brands fa-google"></i>
                                                                <div>
                                                                    <div className="font-medium">Adicionar ao Google Agenda</div>
                                                                    <div className="text-xs text-blue-600">Crie um evento automaticamente</div>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Conte√∫do da Nota
                                                    </label>
                                                    <textarea 
                                                        placeholder="Escreva seu conte√∫do aqui... Use Markdown, listas, ou formata√ß√£o simples. Todos os usu√°rios poder√£o ver e editar este conte√∫do."
                                                        className="w-full h-64 resize-none outline-none text-gray-700 leading-relaxed text-lg bg-transparent"
                                                        value={formContent}
                                                        onChange={(e) => setFormContent(e.target.value)}
                                                    ></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Coment√°rios (direita) */}
                                        <div className="w-full lg:w-96 flex flex-col border-t lg:border-t-0 lg:border-l border-gray-200">
                                            <div className="p-6 border-b border-gray-200">
                                                <div className="flex justify-between items-center">
                                                    <h3 className="font-bold text-gray-800 text-lg flex items-center gap-2">
                                                        <i className="fa-regular fa-comments"></i>
                                                        Discuss√£o
                                                        <span className="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-full">
                                                            {activeComments.length}
                                                        </span>
                                                    </h3>
                                                    <div className="text-sm text-gray-500">
                                                        {activeComments.length === 0 ? 'Sem coment√°rios' : 
                                                         activeComments.length === 1 ? '1 coment√°rio' : 
                                                         `${activeComments.length} coment√°rios`}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                                                {activeComments.length === 0 ? (
                                                    <div className="text-center py-12 text-gray-400">
                                                        <i className="fa-regular fa-comment-dots text-4xl mb-3"></i>
                                                        <p className="font-medium text-gray-600">Nenhum coment√°rio ainda</p>
                                                        <p className="text-sm mt-1">Seja o primeiro a comentar!</p>
                                                    </div>
                                                ) : (
                                                    activeComments.map(comment => (
                                                        <div key={comment.id} className={`p-4 rounded-xl border ${comment.authorId === user?.uid ? 'border-blue-200 bg-blue-50' : 'border-gray-200 bg-gray-50'}`}>
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <div 
                                                                    className="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold"
                                                                    style={{ backgroundColor: comment.userColor || generateUserColor(comment.authorId) }}
                                                                >
                                                                    {getInitials(comment.author)}
                                                                </div>
                                                                <div className="flex-1">
                                                                    <div className="flex justify-between items-baseline">
                                                                        <span className={`font-semibold ${comment.authorId === user?.uid ? 'text-blue-700' : 'text-gray-700'}`}>
                                                                            {comment.author}
                                                                            {comment.authorId === user?.uid && (
                                                                                <span className="ml-2 text-blue-600 text-xs">(Voc√™)</span>
                                                                            )}
                                                                        </span>
                                                                        <span className="text-xs text-gray-400">{formatDate(comment.createdAt)}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <p className="text-gray-700 whitespace-pre-wrap">{comment.content}</p>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                            
                                            <div className="p-6 border-t border-gray-200">
                                                <div className="flex gap-3">
                                                    <div className="flex-1">
                                                        <input 
                                                            type="text" 
                                                            placeholder="Escreva um coment√°rio..." 
                                                            className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                                                            value={newComment}
                                                            onChange={(e) => setNewComment(e.target.value)}
                                                            onKeyPress={(e) => e.key === 'Enter' && handleSendComment()}
                                                        />
                                                    </div>
                                                    <button 
                                                        onClick={handleSendComment}
                                                        disabled={!newComment.trim()}
                                                        className="gradient-primary text-white px-6 py-3 rounded-xl font-medium hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2 shadow-lg hover:shadow-xl"
                                                    >
                                                        <i className="fa-solid fa-paper-plane"></i>
                                                        <span className="hidden sm:inline">Enviar</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Rodap√© */}
                                    <div className="p-6 border-t border-gray-200 flex justify-between items-center bg-gray-50">
                                        <div className="text-sm text-gray-600">
                                            {activeNote ? (
                                                <div className="flex items-center gap-4">
                                                    <span>Criada por <strong>{activeNote.author}</strong> em {formatDateFull(activeNote.createdAt)}</span>
                                                    <span>‚Ä¢</span>
                                                    <span>√öltima edi√ß√£o: <strong>{activeNote.lastEditor || activeNote.author}</strong> ‚Ä¢ {formatDateFull(activeNote.updatedAt)}</span>
                                                </div>
                                            ) : (
                                                <span>Criando nova nota colaborativa ‚Ä¢ Todos os usu√°rios poder√£o editar</span>
                                            )}
                                        </div>
                                        <button 
                                            onClick={handleSaveNote}
                                            className="gradient-primary text-white px-8 py-3 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg hover:shadow-xl flex items-center gap-3"
                                        >
                                            <i className="fa-solid fa-save"></i>
                                            {activeNote ? 'Salvar Altera√ß√µes' : 'Publicar Nota'}
                                        </button>
                                    </div>
                                </div>
                            </div>,
                            document.body
                        )}

                        {/* Footer */}
                        <footer className="mt-16 py-8 border-t border-gray-200 bg-white">
                            <div className="max-w-7xl mx-auto px-4">
                                <div className="flex flex-col md:flex-row justify-between items-center gap-6">
                                    <div className="text-center md:text-left">
                                        <div className="flex items-center justify-center md:justify-start gap-3 mb-3">
                                            <div className="gradient-primary p-2 rounded-lg">
                                                <i className="fa-solid fa-users text-white text-xl"></i>
                                            </div>
                                            <h3 className="text-xl font-bold text-gray-800">ColabNotes</h3>
                                        </div>
                                        <p className="text-gray-600 max-w-md">
                                            Plataforma colaborativa de notas em tempo real. 
                                            Crie, compartilhe e colabore com sua equipe instantaneamente.
                                        </p>
                                    </div>
                                    
                                    <div className="flex flex-wrap gap-6 justify-center">
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-blue-600">{notes.length}</div>
                                            <div className="text-sm text-gray-600">Notas</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-green-600">{totalComments}</div>
                                            <div className="text-sm text-gray-600">Coment√°rios</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-purple-600">{onlineUsers.length + 1}</div>
                                            <div className="text-sm text-gray-600">Online</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-red-600">{totalLikes}</div>
                                            <div className="text-sm text-gray-600">Likes</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="mt-8 pt-8 border-t border-gray-200 text-center text-sm text-gray-500">
                                    <p>
                                        <strong>ColabNotes v2.0</strong> ‚Ä¢ Desenvolvido com React + Firebase ‚Ä¢ 
                                        {new Date().getFullYear()} ‚Ä¢ Todas as notas s√£o p√∫blicas e colaborativas
                                    </p>
                                </div>
                            </div>
                        </footer>
                    </div>
                );
            };

            // ============================================
            // INICIALIZA√á√ÉO
            // ============================================
            try {
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<App />);
                console.log("üöÄ ColabNotes iniciado com sucesso!");
            } catch (error) {
                console.error("‚ùå Erro cr√≠tico ao iniciar:", error);
                document.getElementById('root').innerHTML = `
                    <div class="flex h-screen items-center justify-center bg-gradient-to-br from-red-50 to-pink-50">
                        <div class="text-center p-8 bg-white rounded-2xl shadow-2xl max-w-md">
                            <div class="text-red-500 text-6xl mb-4">‚ö†Ô∏è</div>
                            <h1 class="text-2xl font-bold text-gray-800 mb-3">Erro ao carregar o ColabNotes</h1>
                            <p class="text-gray-600 mb-6">Ocorreu um erro cr√≠tico ao inicializar a aplica√ß√£o.</p>
                            <div class="space-y-3">
                                <button onclick="window.location.reload()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all">
                                    üîÑ Recarregar P√°gina
                                </button>
                                <button onclick="localStorage.clear(); window.location.reload()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-bold transition-all">
                                    üóëÔ∏è Limpar Dados e Recarregar
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-6">
                                Erro: ${error.message}
                            </p>
                        </div>
                    </div>
                `;
            }
        } catch (globalError) {
            console.error("‚ùå Erro global:", globalError);
            document.getElementById('root').innerHTML = `
                <div class="flex h-screen items-center justify-center bg-gradient-to-br from-red-50 to-pink-50">
                    <div class="text-center p-8 bg-white rounded-2xl shadow-2xl max-w-md">
                        <div class="text-red-500 text-6xl mb-4">‚ö†Ô∏è</div>
                        <h1 class="text-2xl font-bold text-gray-800 mb-3">Erro fatal no ColabNotes</h1>
                        <p class="text-gray-600 mb-6">N√£o foi poss√≠vel inicializar a aplica√ß√£o.</p>
                        <button onclick="window.location.reload()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold transition-all">
                            üîÑ Recarregar P√°gina
                        </button>
                        <p class="text-xs text-gray-500 mt-6">
                            Erro: ${globalError.message}
                        </p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
